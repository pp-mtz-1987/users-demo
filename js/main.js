var modalsApp=angular.module("modalsApp",["ui.bootstrap"]),templatesFolfer="templates";modalsApp.factory("modalMessage",["$uibModal",function($uibModal){"use strict";function show(text,options){angular.extend(settings,options),$uibModal.open({animation:!0,templateUrl:templatesFolfer+"/modals/message.html?timestamp="+new Date,controller:["$scope","$uibModalInstance","content",function($scope,$uibModalInstance,content){var $ctrl=this;$scope.content=content,$ctrl.close=function(){$uibModalInstance.dismiss("cancel")}}],controllerAs:"$ctrl",size:settings.size,backdrop:"static",resolve:{content:function(){return{text:text,title:settings.title,closeButtonText:settings.closeButtonText}}}})}var settings={title:"System message",size:"md",closeButtonText:"Close"};return{show:show}}]),modalsApp.factory("modalLoader",["$uibModal",function($uibModal){"use strict";function start(){_isLoading=!0,_modalInstance=$uibModal.open({animation:!0,templateUrl:templatesFolfer+"/modals/loader.html?timestamp="+new Date,size:"md",backdrop:"static"})}function stop(){_isLoading=!1,_modalInstance.dismiss("cancel")}function isLoading(){return _isLoading}var _modalInstance,_isLoading=!1;return{start:start,stop:stop,isLoading:isLoading}}]);var usersApp=angular.module("usersApp",["ui.bootstrap","modalsApp"]);usersApp.controller("users",["$scope","$http","$uibModal","modalLoader","modalMessage",function($scope,$http,$uibModal,modalLoader,modalMessage){$scope.totalUsers=0,$scope.selectedUsers=0,$scope.selectedUserNames=[],modalLoader.isLoading()||(modalLoader.start(),$http.get("https://jsonplaceholder.typicode.com/users").then(function(response){response.data.sort(function(a,b){return a.name>b.name}),$scope.users=response.data,$scope.totalUsers=response.data.length,modalLoader.stop()},function(response){modalLoader.stop(),modalMessage.show("Unexpected error.")})),$scope.toggleSelection=function(selectedUserName){var index=$scope.selectedUserNames.indexOf(selectedUserName);-1===index?$scope.selectedUserNames.push(selectedUserName):$scope.selectedUserNames.splice(index,1),$scope.selectedUsers=$scope.selectedUserNames.length},$scope.confirm=function(){0===$scope.selectedUsers?modalMessage.show("No users selected."):$uibModal.open({animation:!0,templateUrl:"/templates/modals/users-list.html?timestamp="+new Date,size:"md",backdrop:"static",controllerAs:"$ctrl",controller:["$scope","$uibModalInstance","userNames",function($scope,$uibModalInstance,userNames){var $ctrl=this;$scope.userNames=userNames,$ctrl.close=function(){$uibModalInstance.dismiss("cancel")}}],resolve:{userNames:function(){return $scope.selectedUserNames.sort(function(a,b){return a>b}),$scope.selectedUserNames}}})}}]);